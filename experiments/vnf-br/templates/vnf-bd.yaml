descriptor_version: 0.01
id: "{{ bd_id }}"
name: "{{ bd_name }}"
version: "{{ bd_version }}"
author: "{{ bd_author }}"
description: "{{ bd_description }}"

procedures:
  repeat:
    trials: 1
    tests: 1
    method: 1

target:
  id: "{{ sut_id }}"
  name: "{{ sut_name }}"
  version:  "{{ sut_version }}"
  author: "{{ sut_author }}"  # TODO: do we really need this?
  vendor: "{{ sut_vendor }}"
  description: "A sample VNF description"  # TODO: do we really need this?

scenario:
  topology:
    nodes:
      - id:  "{{ sut_id }}"
        type: "{{ sut_type }}" # (type: internal|osm|5gtango)
        {% if sut_type == "5gtango"  %}
        target:  # reference an external SUT definition
          vendor: "{{ sut_vendor }}"
          name: "{{ sut_name }}"
          version: "{{ sut_version }}"
        {% else %}  # default: internal
        # reference image to be used as SUT
        image:  "{{ sut_image }}"
        image_format: "docker"
        {% endif %}
        connection_points:
        - id: "input"
          interface: "ipv4"
          type: "internal"
          address: "172.31.1.2/30"
        - id: "output"
          interface: "ipv4"
          type: "internal"
          address: "172.31.1.3/30"
      - id:  "{{ agent_1_id }}"
        image:  "{{ agent_1_image }}"
        image_format: "docker"
        connection_points:
        - id: "eth1"
          interface: "ipv4"
          type: "internal"
          address: "172.31.1.1/24"
      - id:  "{{ agent_2_id }}"
        image:  "{{ agent_2_image }}"
        image_format: "docker"
        connection_points:
        - id: "eth1"
          interface: "ipv4"
          type: "internal"
          address: "172.31.1.4/24"
    links:
      - id: "{{ agent_1_id }}:{{ sut_id }}"
        type: "{{ network_type or 'E-LAN' }}"
        network: "{{ network_id_1 }}"
        connection_points:
          - "{{ agent_1_id }}:eth1"
          - "{{ sut_id }}:input"
      - id: "{{ sut_id }}:{{ agent_2_id }}"
        type: "{{ network_type or 'E-LAN' }}"
        network: "{{ network_id_2 }}"
        connection_points:
          - "{{ sut_id }}:output"
          - "{{ agent_2_id }}:eth1"
  requirements:
    - id: "{{ sut_id }}"
      resources:
        cpu:
          vcpus: 1
        memory:
          size: 512
          size_unit: "MB"
        storage:
          size: 2
          size_unit: "GB"
    - id: "{{ agent_1_id }}"
      resources:
        cpu:
          vcpus: 1
        memory:
          size: 512
          size_unit: "MB"
        storage:
          size: 2
          size_unit: "GB"
    - id: "{{ agent_2_id }}"
      resources:
        cpu:
          vcpus: 1
        memory:
          size: 512
          size_unit: "MB"
        storage:
          size: 2
          size_unit: "GB"

parameters:
  vnfs:
    - id: "{{ sut_id }}"
  agents:
    - id: "{{ agent_1_id }}"
      probers:
        - id: 4
          parameters:
            client: True
            server: "{{ server }}"
            port: {{ port }}
            protocol: "{{ protocol }}"
            duration: {{ duration }}
            frame_size: {{ frame_size }}
            rate: {{ rate }}
    - id: "{{ agent_2_id }}"
      probers:
        - id: 4
          parameters:
            client: False
            port: {{ port }}
            protocol: "{{ protocol }}"
            duration: {{ duration }}
  monitors:
    - id: "{{ monitor_id }}"
      listeners:
        - id: 17
          parameters:
            target: "{{ container_target }}"
            duration: {{ duration }}
            interval: {{ interval }}
